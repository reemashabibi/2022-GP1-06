<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تسجيل الدخول</title>
    <link href="register.css" rel="stylesheet" >

    <style>
        
    </style>
</head>
<body>

    <div class="center">
        <h1 class="">تسجيل الدخول</h1>
        <form id="logIn">
        <div class="inputbox">
            <input type="email" required="required"  id="emailInp">
            <span>البريد الإلكتروني</span>
          </div>
          <div class="inputbox">
            <input type="password" required="required"  id="passInp">
            <span>كلمة السر</span>
          </div>
          <div class="inputbox">
          <span for="userType" >:اختر نوع المستخدم</span>
         <select name="userType" id="userType">
           <option value="princapl">مدير</option>
           <option value="admin">إداري</option>
        </select>
          </div>
          <div class="inputbox">
            <button type="text" id="subButton" class="btn"  > تسجيل الدخول</button>
        </div>
    </form>
        
        <a href="register.html" class="alink">  مدرسة جديدة؟ التسجيل هنا</a>
        <br>
        <a href="resetPassword.html" class="alink">  نسيت كلمة السر؟</a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-analytics.js";
        import { collection, getDocs, addDoc, Timestamp, deleteDoc , getDoc, updateDoc  } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-firestore.js";
        import { query, orderBy, limit, where, onSnapshot } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-firestore.js";
        import { doc, setDoc } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-firestore.js";
        import { get, ref } from "https://www.gstatic.com/firebasejs/9.12.1//firebase-database.js";



        const firebaseConfig = {
             apiKey: "AIzaSyAk1XvudFS302cnbhPpnIka94st5nA23ZE",
             authDomain: "halaqa-89b43.firebaseapp.com",
             projectId: "halaqa-89b43",
             storageBucket: "halaqa-89b43.appspot.com",
             messagingSenderId: "969971486820",
             appId: "1:969971486820:web:40cc0abf19a909cc470f71",
             measurementId: "G-PCYTHJF1SD"
        };
           const app = initializeApp(firebaseConfig);
           

           export { app, db, collection, getDoc, Timestamp, addDoc, setDoc };
           export { query, orderBy, limit, where, onSnapshot }; 
           const db = getFirestore(app);
           const analytics = getAnalytics(app);

           const userType=document.getElementById("userType");
           const Email=document.getElementById("emailInp");
           const Password=document.getElementById("passInp");
           const submit=document.getElementById("subButton");
           const logInform=document.getElementById("logIn");


           submit.addEventListener('click',  async (e) => {
           e.preventDefault();
           if(!validate()){
            return false;
            logInform.reset();
           }
           const auth = getAuth();
           
           if (userType.value=="principal"){
              
              const q = query(collection(db, "Principal"), where("Email", "==", Email.value));
              const querySnapshot = await getDoc(q);
              if(!querySnapshot.exists()){
               alert("لا يوجد مدير بهذه البيانات يرجى التحقق من البيانات المدخلة");
               logInform.reset();
            }
           
            }
            
            if ((userType.value=="admin")){
              const q = query(collection(db, "Admin"), where("Email", "==", Email.value));
              const querySnapshot = await getDoc(q);
              if(!querySnapshot.exists()){
               alert("لا يوجد إداري بهذه البيانات يرجى التحقق من البيانات المدخلة");
               logInform.reset();
            }
            }
             


           signInWithEmailAndPassword(auth,Email.value,Password.value)
           .then((userCredential) => {
          // Signed in 
           const user = userCredential.user;
           alert("userlogedin");
           if(document.getElementById("userType").value=="princapl"){
            window.location.href="principalHomePage.html";
           }
           else if(userType.value=="admin"){
            window.location.href="adminHomePage.html";

           }
        
           })
        .catch((error) =>{
            alert("somethingis wrong"+error.message);
        })

            


})
           



           











           
        

            
          

            









    </script>


<script type="text/javascript">
    
    
    const Email1=document.getElementById("emailInp");
    const password=document.getElementById("passInp");
  


 function validate() {
  
  if(Email1.value==""||password.value==""){
    alert("جميع الحقول مطلوبة يرجى التحقق من تعبئتها");
    return false;
  }

 
  else {
    return true;
   }
 }
 
 </script>








  

    
</body>
</html>