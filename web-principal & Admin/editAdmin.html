



<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="register.css" rel="stylesheet" >
<title>معلومات الحساب</title>
</head>
<body>
<script type="module">
    
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-analytics.js";
    import { collection, getDocs, addDoc, Timestamp, deleteDoc , getDoc, updateDoc , doc } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-firestore.js";
    import { query, orderBy, limit, where, onSnapshot } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-firestore.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-firestore.js";
    import { get, ref } from "https://www.gstatic.com/firebasejs/9.12.1//firebase-database.js"
    import { getAuth, onAuthStateChanged , updateProfile} from "https://www.gstatic.com/firebasejs/9.12.1/firebase-auth.js";
    const firebaseConfig = {
      apiKey: "AIzaSyAk1XvudFS302cnbhPpnIka94st5nA23ZE",
      authDomain: "halaqa-89b43.firebaseapp.com",
      projectId: "halaqa-89b43",
      storageBucket: "halaqa-89b43.appspot.com",
      messagingSenderId: "969971486820",
      appId: "1:969971486820:web:40cc0abf19a909cc470f71",
      measurementId: "G-PCYTHJF1SD"
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth();
    const user= auth.currentUser;
    const uid= user.uid;//"kfGIwTyclpNernBQqSpQhkclzhh1";
    onAuthStateChanged(auth, (user)=>{
        if(user){
            console.log("the same user");
            console.log(auth.currentUser);
            
        }
        else{
            window.location.href="index.html";
            console.log("the  user changed");
        }

    });

    



   
    
    export { app, db, collection, getDocs, Timestamp, addDoc };
    export { query, orderBy, limit, where, onSnapshot }; 
        const FirstName=document.getElementById("fnameInp");
        const LastName=document.getElementById("lnameInp");
        const Email=document.getElementById("emailInp");
        const Password=document.getElementById("passInp");
    


    const db = getFirestore(app);
    document.onload(fillData(uid));
    async function fillData(uid){

    const docRef= doc(db,"School",uid);
    await getDoc(docRef)
    .then((doc)=>{
        console.log(doc.data(), doc.id);
        
        FirstName.value=doc.data().PrincipalFirstName;
        LastName.value=doc.data().PrincipalLastName;
        Email.value=doc.data().Email;
        //Password.value=user.Password;

    });
    }
    const save = document.getElementById("subButton");
    save.addEventListener('click', async (e) => {
  e.preventDefault();
  const docRef= doc(db,"School",uid);
  
    updateProfile(auth.currentUser, {
      Email:Email.value , Password:Password.value
     }).then(() => {
        updateDoc(docRef,{
    SchoolName:document.getElementById("snameInp").value,
    PrincipalFirstName: FirstName.value,
    PrincipalLastName:LastName.value,
    Email: Email.value,
  })

     });
  


})

  
  </script>


  <div class="center" >
    <h1 >   معلومات الحساب</h1>
    <form id="updateForm">
 
 
 <div class="inputbox">
    <input type="text" required="required" id="fnameInp"   >
    <span>الاسم الأول  </span>
 </div>
 <div class="inputbox">
    <input type="text" required="required" id="lnameInp"  >
    <span>الاسم الأخير  </span>
 </div>
 <div class="inputbox">
    <input type="email" required="required"  id="emailInp">
    <span>البريد الإلكتروني</span>
  </div>
  <div class="inputbox">
    <input type="password" required="required"  id="passInp">
    <span>كلمة السر</span>
  </div>
  
  <div class="inputbox">
    <button type="text" id="subButton" class="btn"  >حفظ</button>
</div>
</form>
<br>
<br>

</div>
</body>
</html>